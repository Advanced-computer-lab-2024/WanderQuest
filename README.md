<p align="center">
<img src="https://github.com/Advanced-computer-lab-2024/WanderQuest/blob/main/Front-End/wanderquest/public/logo.png" width="400" />

<a href="https://git.io/typing-svg"><img src="https://readme-typing-svg.herokuapp.com?font=Fira+Code&size=40&pause=1000&color=F7F7F7&center=true&vCenter=true&random=false&width=1200&height=100&lines=WanderQuest%3A+Where+Your+Adventures+Come+to+Life" alt="Typing SVG" /></a>

</p>

# WanderQuest

## Table of Contents

1. [üöÄ Motivation](#-motivation)
2. [üß± Build Status](#-build-status)
3. [üé® Code Style](#-code-style)
4. [‚öíÔ∏è Tech and Frameworks used](#%EF%B8%8F-tech-and-frameworks-used)
5. [üî• Features & Screenshots](#-features--screenshots)
6. [üíª Code Examples](#-code-examples)
7. [‚öôÔ∏è Installation](#%EF%B8%8F-installation)
8. [üìö API Reference](#-api-reference)
9. [üß™ Tests](#-tests)
10. [üßëüèª‚Äçüè´ How to Use](#-how-to-use)
11. [ü§ù Contribute](#-contribute)
12. [¬©Ô∏è Credits](#-credits)
13. [üìú License](#-license)

## üöÄ Motivation

Welcome to WanderQuest, your ultimate travel companion designed to transform vacation planning into an effortless and unforgettable experience! Whether you're longing for serene beaches, historic landmarks, or thrilling family adventures, our platform caters to every travel dream.

## üß± Build Status

![example workflow](https://github.com/Advanced-Computer-Lab-2023/Copilot-and-Sons-Clinic/actions/workflows/test.yml/badge.svg)

- This project is under development and should not be used in a production settings
- Check **Issues** for a list of all the reported issues
- More automated tests should be added in the future
- More documentation should be added

## üé® Code Style

We use [Prettier](https://prettier.io/) to enforce a consistent code style.

<details>
<summary>Useful Commands</summary>

### Useful Commands

- Check formatting using Prettier

```bash
npm run format
```

- And then fix formatting using Prettier

```bash
npm run format:fix
```

</details>

## ‚öíÔ∏è Tech and Frameworks used

- [NodeJs](https://nodejs.org/en/)
- [Express](https://expressjs.com/)
- [ReactJs](https://reactjs.org/)
- [MongoDB](https://www.mongodb.com/)
- [Mongoose](https://mongoosejs.com/)
- [Docker](https://www.docker.com/)
- [Docker Compose](https://docs.docker.com/compose/)
- [Prettier](https://prettier.io/)
- [MUI](https://mui.com/)
- [React Router](https://reactrouter.com/)
- [React Hook Form](https://react-hook-form.com/)
- [React Query](https://react-query.tanstack.com/)
- [Formik](https://formik.org/)
- [Toastify](https://fkhadra.github.io/react-toastify/introduction)
- [Socket.io](https://socket.io/)
- [Firebase Storage](https://firebase.google.com/docs/storage)
- [NodeMailer](https://nodemailer.com/about/)
- [JsonWebToken](https://jwt.io/)
- [Bcrypt](https://www.npmjs.com/package/bcrypt)
- [Postman](https://www.postman.com/)

## üî• Features & Screenshots

<details>
<summary>User Registration üìù</summary>

- Register as a tourist/advertiser/tour guide/seller with essential details.
- Submit a request to register as an advertiser/tour guide/seller with professional details.
- Upload required documents for advertiser/tour guide/seller registration.

![image](https://github.com/advanced-computer-lab-2023/Copilot-and-Sons-Clinic/blob/main/images/user-registration.png)
</details>

<details>
<summary>User Authentication üîê</summary>
- Login and logout securely.

![image](https://github.com/advanced-computer-lab-2023/Copilot-and-Sons-Clinic/blob/main/images/user-authentication.png)

</details>

<details>
<summary>Administrator Functions üë©‚Äçüíº</summary>
- Add/remove another administrator.
- Add/remove a tourism governor.
- Manage all users.
- Add/edit/remove/view products/activities/itineraries/categories/tags.
- Archive/unarchive products.
- Accept or reject advertiser/tour guide/seller registration requests.
- View information uploaded by advertiser/tour guide/seller.
- View complaints.
- Mark a complaint as pending or resolved or reply to it.
- Create/delete/view promocodes.
- Search/Filter/Sort for a product based on product name/price/ratings.

![image](https://github.com/advanced-computer-lab-2023/Copilot-and-Sons-Clinic/blob/main/images/administrator-functions.png)

</details>

<details>
<summary>Account Management üîÑ</summary>
- Change password.
- Reset forgotten password via email.
- Request to delete account.

![image](https://github.com/advanced-computer-lab-2023/Copilot-and-Sons-Clinic/blob/main/images/account-management.png)

</details>

<details>
<summary>Seller Functions</summary>
- Accept Terms and Conditions.
- Create/Read/Update their profile with their information including name and description. If accepted on the system.
- View a list of all available products.
- Search/Filter/Sort for a product based on product name/price/ratings.
- Add/Edit/View a product with its details, price and available quantity.
- Upload a picture.
- View/Filter sales report
- Archive/unarchive products.
- Search/Filter/Sort for a product based on product name/price/ratings.

![image](https://github.com/advanced-computer-lab-2023/Copilot-and-Sons-Clinic/blob/main/images/doctor-functions.png)

</details>

<details>
<summary>Advertiser Functions</summary>
- Accept Terms and Conditions.
- Create/Read/Update their profile with their information. If accepted on the system.
- View a list of all advertisers.
- Create/update/delete activities.
- View created activities.
- Create/view transportation posts.
- Get/mark as read notifications.

![image](https://github.com/advanced-computer-lab-2023/Copilot-and-Sons-Clinic/blob/main/images/doctor-functions.png)

</details>

<details>
<summary>Tourist Functions</summary>
- Read/Update their profile with their information.
- Book trips.
- Pay for bookings using wallet or credit card.
- Add to/remove from/view wishlist.
- View saved events.
- View all orders.
- Issue/cancel an order.
- View available products/ upcoming activities/itineraries/places.
- Search/Filter/Sort for a product based on product name/price/ratings.
- Rate/review a product.
- Redeem points/promocode.
- File a complaint.
- View my complaints/level/available points.
- Change preferred currency.
- Manage notifications.
- Be notified/request to be notified for when a saved event is open for bookings.
- Be reminded of your Booked Events getting Within 4 days of check.
- Recieve a promocode on your birthday in notifications.
- View/add/remove/edit/checkout to/from cart.
  
![image](https://github.com/advanced-computer-lab-2023/Copilot-and-Sons-Clinic/blob/main/images/patient-functions.png)

</details>

<details>
<summary>Tour Guide Functions</summary>
- Accept Terms and Conditions.
- Create/Read/Update their profile with their information. If accepted on the system.
- View a list of all advertisers.
- Create/update/delete/view/activate/deactivate itineraries.
- Rate/comment on tour guide.
- Manage notifications.
  
![image](https://github.com/advanced-computer-lab-2023/Copilot-and-Sons-Clinic/blob/main/images/patient-functions.png)

</details>

<details>
<summary>Tourism Governor Functions</summary>
- Create/update/delete/view places.
- Add/view tags.
  
![image](https://github.com/advanced-computer-lab-2023/Copilot-and-Sons-Clinic/blob/main/images/patient-functions.png)

</details>


## üíª Code Examples

<details>
<summary>BE Routes Example</summary>

```js
router.use('/auth', authRouter)
router.use('/doctors', doctorsRouter)

router.use('/debug', debugRouter)

router.use('/prescriptions', prescriptionsRouter)
router.use('/family-members', familyMemberRouter)
router.use('/health-packages', healthPackagesRouter)
router.use('/patients', patientRouter)
router.use('/appointment', appointmentsRouter)
router.use('/admins', asyncWrapper(allowAdmins), adminRouter)
```

</details>

<details>
<summary>BE Add Health Package Controller Example</summary>

```js
export const healthPackagesRouter = Router()

healthPackagesRouter.post(
  '/',
  asyncWrapper(allowAdmins),
  validate(CreateHealthPackageRequestValidator),
  asyncWrapper<createHealthPackageRequest>(async (req, res) => {
    const healthPackage = await addHealthPackages(req.body)

    res.send({
      name: healthPackage.name,
      id: healthPackage.id,
      pricePerYear: healthPackage.pricePerYear,
      sessionDiscount: healthPackage.sessionDiscount,
      medicineDiscount: healthPackage.medicineDiscount,
      familyMemberSubscribtionDiscount:
        'healthPackage'.familyMemberSubscribtionDiscount,
    } satisfies AddHealthPackageResponse)
  })
)
```

</details>

<details>
<summary>BE Add Health Package Service Example</summary>

```js

export async function addHealthPackages(
  request: createHealthPackageRequest
): Promise<HydratedDocument<HealthPackageDocument>> {
  const healthPackage = await HealthPackageModel.create({
    name: request.name,
    pricePerYear: request.pricePerYear,
    sessionDiscount: request.sessionDiscount,
    medicineDiscount: request.medicineDiscount,
    familyMemberSubscribtionDiscount: request.familyMemberSubscribtionDiscount,
  })

  return healthPackage
}
```

</details>

<details>
<summary>BE Health Package Model Example</summary>

```js
import mongoose from 'mongoose'
const Schema = mongoose.Schema
const healthPackageSchema = new Schema(
  {
    name: { type: String, required: true, unique: true },
    pricePerYear: { type: Number, required: true },
    sessionDiscount: { type: Number, required: true },
    medicineDiscount: { type: Number, required: true },
    familyMemberSubscribtionDiscount: {
      type: Number,
      required: true,
    },
  },
  { timestamps: true }
)

export type HealthPackageDocument = mongoose.InferSchemaType<
  typeof healthPackageSchema
>

export const HealthPackageModel = mongoose.model(
  'HealthPackage',
  healthPackageSchema
)
```

</details>

<details>
<summary>Add Health Package Validator Example</summary>

```js
import * as zod from 'zod'

export const CreateHealthPackageRequestValidator = zod.object({
  name: zod.string().min(1),
  pricePerYear: zod.number(),
  sessionDiscount: zod.number(),
  medicineDiscount: zod.number(),
  familyMemberSubscribtionDiscount: zod.number(),
})
```

</details>

<details>
<summary>Health Package TypeScript Types Example</summary>

```js
export type createHealthPackageRequest = z.infer<
  typeof CreateHealthPackageRequestValidator
>

export type UpdateHealthPackageRequest = z.infer<
  typeof UpdateHealthPackageRequestValidator
>

export interface HealthPackageResponseBase {
  name: string
  id: string
  pricePerYear: number
  sessionDiscount: number
  medicineDiscount: number
  familyMemberSubscribtionDiscount: number
}

export interface UpdateHealthPackageResponse
  extends HealthPackageResponseBase {}

export interface AddHealthPackageResponse extends HealthPackageResponseBase {}
```

</details>

<details>
<summary>FE Admin Dashboard Routes Example</summary>

```js

        <ul>
            <li>
              <Link href="/admin/Requests">Users Management</Link>
            </li>
            <li>
              <Link href="/admin/deleteAccount">Delete Account</Link>
            </li>
            <li>
              <Link href="/admin/addGovernor">Add Tourism Governor</Link>
            </li>
            <li>
              <Link href="/admin/addAdmin">Add Admin</Link>
            </li>
            <li>
              <Link href="/admin/editprod">Add Product</Link>
            </li>
            <li>
              <Link href="/admin/complaints">Complaints</Link>
            </li>
            <li>
              <Link href="/admin/promoCodes">Create Promocode</Link>
            </li>
            <li>
              <Link href="/admin/prefTags">Preference Tags</Link>
            </li>
            
          </ul>
```

</details>


## ‚öôÔ∏è Installation

- Make sure you have [Node](https://nodejs.org/en) and [Git](https://git-scm.com/) installed

```bash
mkdir Copilot-and-Sons
cd Copilot-and-Sons
```

- Clone this repo

```bash
git clone https://github.com/Advanced-computer-lab-2024/WanderQuest.git
```

- Install dependencies

```bash
cd WanderQuest
npm install
```

## üìö API Reference

<details>
<summary>Admin Endpoints</summary>

- `POST /admins` - Add a new admin
  - **Request body**
    - `username`: string
    - `password`: string
    - `email`: string
  - **Response**: The created admin
- `GET /admins/get-users` - Get all users
  - **Response**: A list of all users
  ```
  [
      {
          username: string,
          type: string
      }
  ]
  ```
- `DELETE /admins/username/:id` - Delete a user by username
</details>

<details>
<summary>Appointment Endpoints</summary>

- `GET /appointment/filter` - Returns a list of all appointments
  - **Response Body**
  ```
  [
      {
          'id': string,
          'patientID': string,
          'doctorID': string,
          'doctorName': string,
          'doctorTimes': string[],
          'date': string,
          'familyID': string,
          'reservedFor': string
          'status': AppointmentStatus
      }
  ]
  ```
- `POST /appointment/makeappointment` - Reserve an appointment
  - **Request Body**
  ```
  {
      'doctorid': string,
      'date': Date | null,
      'familyID': string,
      'reservedFor': string,
      'toPayUsingWallet': number,
      'sessionPrice': number
  }
  ```
  - **Response Body**
  ```
  {
      'id': string,
      'patientID': string,
      'doctorID': string,
      'doctorName': string,
      'doctorTimes': string[],
      'date': string,
      'familyID': string,
      'reservedFor': string
      'status': AppointmentStatus
  }
  ```
- `POST /appointment/delete/:id` - Delete an appointment
  - **Request Body**
  ```
  {
      'appointmentId': string,
      'cancelledByDoctor': boolean
  }
  ```
- `POST /appointment/reschedule` - Reschedule an appointment - **Request Body**
`     {
        appointment: string, 
        rescheduleDate: string
    }
    ` - **Response Body**
`     {
        'id': string,
        'patientID': string,
        'doctorID': string,
        'doctorName': string,
        'doctorTimes': string[],
        'date': string,
        'familyID': string,
        'reservedFor': string
        'status': AppointmentStatus
    }
    `
</details>

<details>
<summary>Auth Endpoints</summary>

- `POST /auth/login` - Authenticate a user and retrieve an access token.

  - **Request Body:**

  ```json
  {
    "username": "string",
    "password": "string"
  }
  ```

  - **Response Body:**

  ```json
  {
    "token": "string"
  }
  ```

- `POST /auth/register-patient` - Register a patient and obtain an access token.

  - **Request Body:**

  ```json
  {
    "username": "string",
    "name": "string",
    "email": "string",
    "password": "string",
    "dateOfBirth": "string",
    "gender": "string",
    "mobileNumber": "string",
    "emergencyContact": {
      "fullName": "string",
      "mobileNumber": "string"
    }
  }
  ```

  - **Response Body:**

  ```json
  {
    "token": "string"
  }
  ```

- `GET /auth/me` - Retrieve information about the currently authenticated user.

- **Response Body:**

  ```json
  {
    "id": "string",
    "username": "string",
    "name": "string",
    "email": "string",
    "dateOfBirth": "string",
    "gender": "string",
    "mobileNumber": "string",
    "emergencyContact": {
      "fullName": "string",
      "mobileNumber": "string"
    }
  }
  ```

- `POST /patient/requestOtp` - Request to send OTP for forgetting password

  - **Request Body:**

  ```
  {
      email: string
  }
  ```

  - **Response Body:**: N/A

- `POST /patient/verifyOtp` - Verify OTP for forgetting password

  - **Request Body:**

  ```
  {
      email: string,
      otp: string,
  }
  ```

  - **Response Body:**: N/A

- `POST /patient/updatePassword` - Update patient password after forgetting password

      - **Request Body:**
      ```
      {
          email: string,
          newPassword: string
      }
      ```

      - **Response Body:**: N/A

</details>

<details>
<summary>Chat Endpoints</summary>

- `POST '/chats/get-all' - Get all chats for a user
  - **Request Body**:
  ```
  {
      'username': string // Could be username of a patient, doctor, or admin
  }
  ```
  - **Response Body**
  ```
  {
      'id': string
      'users': Array<{
          'id': string
          'username': string
          'name': string
          'email': string
          'type': UserType
      }>
      'createdAt': string
      'lastMessage': string
      'hasUnreadMessages': boolean
  }
  ```
- `POST /chats/create-or-get` - Creates a new chat or gets one if it already exists between the users
  - **Request Body**
    ```
    {
        'initiator': string
        'receiver': string
    }
    ```
  - **Reponse Body**: `string` -> ID of the created chat
- `POST /chats/get-by-id` - Gets a chat by its id

  - **Request Body**
    ```
    {
        'chatId': string
        'readerUsername': string
    }
    ```
  - **Reponse Body**
    ```
    {
        'id': string
        users: Array<{
            'id': string
            'username': string
            'name': string
            'email': string
            'type': UserType
        }>
        'messages': Array<{
            'id': string
            'sender': string
            'senderType': UserType
            'senderDetails': {
                'name': string
                'email': string
            }
            'content': string
            'createdAt': string
        }>
        'createdAt': string
        'lastMessage': string
        'hasUnreadMessages': boolean
    }
    ```

- `POST /chats/send-message` - Sends a message

  - **Request Body**
    ```
    {
        'chatId': string
        'senderUsername': string
        'content': string
    }
    ```
  - **Reponse Body**: N/A

- `POST '/chats/mark-as-read'` - Marks a chat as being read
  - **Request Body**
    ```
    {
        'chatId': string
        'username': string
    }
    ```
  - **Reponse Body**: N/A

</details>

<details>
<summary>Doctors Endpoints</summary>

- `PATCH '/doctors/updateDoctor/:username'` - Updates a doctor information
  - **Request Body**
    ```
    {
        'name': string,
        'email': string,
        'dateOfBirth': string,
        'hourlyRate': number,
        'affiliation': string,
        'educationalBackground': string,
    }
    ```
  - **Reponse Body**:
    ```
    {
        'id': string
        'username': string
        'name': string
        'email': string
        'dateOfBirth': Date
        'hourlyRate': number
        'affiliation': string
        'educationalBackground': string
        'speciality': string
        'requestStatus': DoctorStatus
    }
    ```
- `GET /doctors/:username` - Gets doctor information by username

  - **Request Body**: N/A
  - **Reponse Body**:
    ```
    {
        'id': string
        'username': string
        'name': string
        'email': string
        'dateOfBirth': Date
        'hourlyRate': number
        'affiliation': string
        'educationalBackground': string
        'speciality': string
        'requestStatus': DoctorStatus
        'contractStatus': ContractStatus
        'availableTimes': [Date]
        'employmentContract': [string]
        'documents': [string]
        'wallet': number
    }
    ```

- `GET /doctors/pending` - Gets pending doctors requests

  - **Request Body**: N/A
  - **Reponse Body**:
    ```
    {
        'doctors': Array<{
            'id': string
            'username': string
            'name': string
            'email': string
            'dateOfBirth': Date
            'hourlyRate': number
            'affiliation': string
            'educationalBackground': string
            'speciality': string
            'requestStatus': DoctorStatus
        }>
    }
    ```

- `GET /doctors/approved` - Gets approved doctors

  - **Request Body**: N/A
  - **Reponse Body**:
    ```
    {
        'doctors': Array<{
            'id': string
            'username': string
            'name': string
            'email': string
            'dateOfBirth': Date
            'hourlyRate': number
            'affiliation': string
            'educationalBackground': string
            'speciality': string
            'requestStatus': DoctorStatus
        }>
    }
    ```

- `GET /doctors/approved/:id` - Gets approved doctor by id

  - **Request Body**: N/A
  - **Reponse Body**:
    ```
    {
        'id': string
        'username': string
        'name': string
        'email': string
        'dateOfBirth': Date
        'hourlyRate': number
        'affiliation': string
        'educationalBackground': string
        'speciality': string
        'requestStatus': DoctorStatus
        'availableTimes': [Date]
        'sessionRate': number
        'hasDiscount': boolean
        'hourlyRateWithMarkup': number
    }
    ```

- `PATCH /doctors/acceptDoctorRequest/:id` - Accept a doctor by id
  - **Request Body**: N/A
  - **Reponse Body**:
    ```
    {
        'id': string
        'username': string
        'name': string
        'email': string
        'dateOfBirth': Date
        'hourlyRate': number
        'affiliation': string
        'educationalBackground': string
        'speciality': string
        'requestStatus': DoctorStatus
        'availableTimes': [Date]
        'sessionRate': number
        'hasDiscount': boolean
        'hourlyRateWithMarkup': number
    }
    ```
- `PATCH /doctors/rejectDoctorRequest/:id` - Reject a doctor by id
  - **Request Body**: N/A
  - **Reponse Body**:
    ```
    {
        'id': string
        'username': string
        'name': string
        'email': string
        'dateOfBirth': Date
        'hourlyRate': number
        'affiliation': string
        'educationalBackground': string
        'speciality': string
        'requestStatus': DoctorStatus
        'availableTimes': [Date]
        'sessionRate': number
        'hasDiscount': boolean
        'hourlyRateWithMarkup': number
    }
    ```
- `PATCH /doctors/addAvailableTimeSlots` - Add available time slots for doctor

  - **Request Body**:
    ```
    {
        'time': Date,
    }
    ```
  - **Reponse Body**:
    ```
    {
        'id': string
        'username': string
        'name': string
        'email': string
        'dateOfBirth': Date
        'hourlyRate': number
        'affiliation': string
        'educationalBackground': string
        'speciality': string
        'requestStatus': DoctorStatus
        'availableTimes': [Date]
    }
    ```

- `PATCH /doctors/acceptEmploymentContract` - Accept employment contract

  - **Request Body**: N/A
  - **Reponse Body**:
    ```
    {
        'id': string
        'username': string
        'name': string
        'email': string
        'dateOfBirth': Date
        'hourlyRate': number
        'affiliation': string
        'educationalBackground': string
        'speciality': string
        'requestStatus': DoctorStatus
        'contractStatus': ContractStatus
        'availableTimes': [Date]
        'employmentContract': [string]
        'documents': [string]
    }
    ```

- `PATCH /doctors/rejectEmploymentContract` - Reject employment contract
  - **Request Body**: N/A
  - **Reponse Body**:
    ```
    {
        'id': string
        'username': string
        'name': string
        'email': string
        'dateOfBirth': Date
        'hourlyRate': number
        'affiliation': string
        'educationalBackground': string
        'speciality': string
        'requestStatus': DoctorStatus
        'contractStatus': ContractStatus
        'availableTimes': [Date]
        'employmentContract': [string]
        'documents': [string]
    }
    ```
- `GET /doctors/wallet/:username` - Get doctor's wallet money

  - **Request Body**: N/A
  - **Reponse Body**:
    ```
    {
        'money': number
    }
    ```

- `POST /doctors/for-patient` - Get doctor for patient
  - **Request Body**:
    ```
    {
       'patientUsername': string
    }
    ```
  - **Reponse Body**:
    ```
    [
        {
            'id': string
            'username': string
            'name': string
        }
    ]
    ```
- `POST /auth/request-doctor'` - Request to register as a doctor
  - **Request Body**:
    ```
    {
        'name': string
        'email': string
        'username': string
        'password': string
        'dateOfBirth': string
        'hourlyRate': number
        'affiliation': string
        'educationalBackground': string
        'speciality': string
        'documents': File[]
    }
    ```
  - **Reponse Body**:
    ```
    {
        'id': string
        'username': string
        'name': string
        'email': string
        'dateOfBirth': Date
        'hourlyRate': number
        'affiliation': string
        'educationalBackground': string
        'speciality': string
        'requestStatus': DoctorStatus
    }
    ```
- `POST /patients/uploadHealthRecords/:id'` - Upload health record for a patient

  - **Request Body**:
    ```
    {
        HealthRecord: File[]
    }
    ```
  - **Reponse Body**:
    ```
    {
        'id': string,
        'username': string,
        'name': string,
        'email': string,
        'mobileNumber': string,
        'dateOfBirth': Date,
        'gender': Gender,
        'emergencyContact': {
            'name': string
            'mobileNumber': string
        },
        'notes': string[]
    }
    ```

- `POST /patients/deleteHealthRecord/:id'` - Delete health record for a patient

  - **Request Body**:
    ```
    {
        url: string // URL to delete
    }
    ```
  - **Reponse Body**: N/A

- `GET /patients/getMedicalHistory/:id` - Get medical history of patient

  - **Request Body**: N/A
  - **Reponse Body**: `[string]`

- `PATCH /doctors/acceptFollowupRequest/:id` - Accept a followup request by id of the request
  - **Request Body**: N/A
  - **Reponse Body**: N/A
- `PATCH /doctors/rejectFollowupRequest/:id` - Reject a followup request by id of the request - **Request Body**: N/A - **Reponse Body**: N/A
</details>

<details>
<summary>Family Members Endpoints</summary>

- `GET /family-members/mine` - Get family members of currently logged in user

  - **Request Body**: N/A
  - **Reponse Body**:
    ```
    {
        'id': string
        'name': string
        'nationalId': string
        'age': number
        'gender': Gender
        'relation': Relation
        'healthPackage': {
            'name'?: string
            'renewalDate'?: string
            'id'?: string
        }
        'healthPackageHistory': [
            { package: string; date: Date }
         ] //has the name not id
    }
    ```

- `GET /family-members/linking-me` - Get names of users linking me as family member

  - **Request Body**: N/A
  - **Reponse Body**: `[string]`

- `GET /family-members/:id` - Get family member details by id

  - **Request Body**: N/A
  - **Reponse Body**:
    ```
    {
        'familyMember': {
            'id': string
            'name': string
            'nationalId': string
            'age': number
            'gender': Gender
            'relation': Relation
            'healthPackage': {
                'name'?: string
                'renewalDate'?: string
                'id'?: string
            }
            'healthPackageHistory': [
                { package: string; date: Date }
            ] //has the name not id
        }
        'patient': {
            'id': string,
            'username': string,
            'name': string,
            'email': string,
            'mobileNumber': string,
            'dateOfBirth': Date,
            'gender': Gender,
            'emergencyContact': {
                'name': string
                'mobileNumber': string
            },
            'notes': string[]
        }
    }
    ```

- `POST /family-members/:username:` - Add a family member to patient that has certain username

  - **Request Body**:
    ```
    {
        name: string,
        nationalId: string,
        age: number,
        gender: string,
        relation: string,
    }
    ```
  - **Reponse Body**: N/A

- `POST /family-members/link` - Link a family member

  - **Request Body**:
    ```
    {
        'email'?: string,
        'phonenumber'?: string,
        'relation': string,
    }
    ```
  - **Reponse Body**:
    ```
    {
        'id': string
        'name': string
        'nationalId': string
        'age': number
        'gender': Gender
        'relation': Relation
        'healthPackage': {
            'name'?: string
            'renewalDate'?: string
            'id'?: string
        }
        'healthPackageHistory': [
            { package: string; date: Date }
        ] //has the name not id
    }
    ```

- `GET /family-members/mine/linked` - Get linked family members of current user - **Request Body**: N/A - **Reponse Body**:
`          {
            'id': string
            'patientId': string
            'username': string
            'mobileNumber': string
            'email': string
            'dateOfBirth': string
            'name': string
            'gender': string
            'relation': Relation
            'healthPackage': {
                'name': string
                'id': string
            }
        }
        `
</details>

<details>
<summary>Health Packages Endpoints</summary>

- `POST /health-packages/for-patient` - Get health packages for patient

  - **Request Body**:
    ```
    {
        'patientId': string,
        'isFamilyMember': boolean, // Whether the patient is a family member or an actual patient
    }
    ```
  - **Reponse Body**:
    ```
    [
        {
            'name': string
            'id': string
            'pricePerYear': number
            'sessionDiscount': number
            'medicineDiscount': number
            'familyMemberSubscribtionDiscount': number
            'discountedPricePerYear': number
        }
    ]
    ```

- `GET /health-packages` - Get all health packages

  - **Request Body**: N/A
  - **Reponse Body**:
    ```
    [
        {
            'name': string
            'id': string
            'pricePerYear': number
            'sessionDiscount': number
            'medicineDiscount': number
            'familyMemberSubscribtionDiscount': number
        }
    ]
    ```

- `GET /health-packages/:id` - Get a health package by id
  - **Request Body**: N/A
  - **Reponse Body**:
    ```
    {
        'name': string
        'id': string
        'pricePerYear': number
        'sessionDiscount': number
        'medicineDiscount': number
        'familyMemberSubscribtionDiscount': number
    }
    ```
- `PATCH /health-packages/:id` - Update a health package by id

  - **Request Body**:
    ```
    {
        name: string,
        pricePerYear: number,
        sessionDiscount: number,
        medicineDiscount: number,
        familyMemberSubscribtionDiscount: number,
    }
    ```
  - **Reponse Body**: `string` -> ID of the updated health package

- `POST /health-packages` - Create a health package

  - **Request Body**:
    ```
    {
        name: string,
        pricePerYear: number,
        sessionDiscount: number,
        medicineDiscount: number,
        familyMemberSubscribtionDiscount: number,
    }
    ```
  - **Reponse Body**:
    ```
    {
        'name': string
        'id': string
        'pricePerYear': number
        'sessionDiscount': number
        'medicineDiscount': number
        'familyMemberSubscribtionDiscount': number
    }
    ```

- `DELETE /health-packages/:id` - Delete a health package
  - **Request Body**: N/A
  - **Reponse Body**: `string` -> ID of the deleted health package
- `GET /health-packages/isPackageHasSubscribers/:id` - Check if a health package has subscribers
  - **Request Body**: N/A
  - **Reponse Body**: `boolean`
- `PATCH /health-packages/wallet/subscriptions` - Subscribe to a health package using wallet

  - **Request Body**:

    ```
    {
        // patientId or familyMemberId for the person that should be subscribed to the health package
        'subscriberId': string

        // The person that is paying for the subscription
        'payerUsername': string

        // Indicates whether the subscribee is a the id for FamilyMember or Patient
        'isFamilyMember': boolean
        'healthPackageId': string
    }
    ```

  - **Reponse Body**: N/A

- `PATCH /health-packages/credit-card/subscriptions` - Subscribe to a health package using credit card

  - **Request Body**:

    ```
    {
        // patientId or familyMemberId for the person that should be subscribed to the health package
        'subscriberId': string

        // The person that is paying for the subscription
        'payerUsername': string

        // Indicates whether the subscribee is a the id for FamilyMember or Patient
        'isFamilyMember': boolean
        'healthPackageId': string
    }
    ```

  - **Reponse Body**: N/A

- `POST /health-packages/unsubscribe` - Unsubscribe to a health package using credit card
  - **Request Body**:
    ```
    {
        'subscriberId': string
        'payerUsername': string
        'isFamilyMember': boolean
    }
    ```
  - **Reponse Body**: N/A
- `POST /health-packages/subscribed` - Get health package of user
  - **Request Body**:
    ```
    {
        'patientId': string // patientId or familyMemberId
        'isFamilyMember': boolean
    }
    ```
  - **Reponse Body**:
    ```
    {
        healthPackage: {
            'name': string
            'id': string
            'pricePerYear': number
            'sessionDiscount': number
            'medicineDiscount': number
            'familyMemberSubscribtionDiscount': number
            'renewalDate': string
            'remainingMonths': number
        },
    }
    ```
- `POST /health-packages/patient-cancelled` - Get cancelled health packages of user
  - **Request Body**:
    ```
    {
        'id': string // patientId or familyMemberId
        'isFamilyMember': boolean
    }
    ```
  - **Reponse Body**:
    ```
    {
        // Maps ID of cancelled healthPackage to Date of cancellation
        [id: string]: string
    }
    ```
- `POST /health-packages/cancellation-date/:healthPackageId` - Get cancellation date for health package of user - **Request Body**:
  `        { id: string; isFamilyMember: boolean }` - **Reponse Body**: `string` -> Date of cancellation
  </details>

<details>
<summary>Notifications Endpoints</summary>

- `POST /notifications/all'` - Get all notifications for a user

  - **Request Body**:
    ```
    {
        'username': string,
    }
    ```
  - **Reponse Body**:
    ```
    {
        notifications: [
            {
                _id: string
                title: string
                description?: string
            }
        ]
    }
    ```

- `DELETE /notifications'` - Delete a notification
  - **Request Body**:
  ```
  {
    username: string,
    notificationId: string,
  }
  ```
  - **Reponse Body**: N/A

</details>

<details>
<summary>Patient Endpoints</summary>

- `GET /patients/myPatients'` - Get all patients for a user

  - **Request Body**: N/A
  - **Reponse Body**:
    ```
    [
        {
            id: string
            name: string
            username: string
            email: string
            mobileNumber: string
            dateOfBirth: string
            gender: Gender
            emergencyContact: {
                name: string
                mobileNumber: string
            }
            familyMembers: string[]
        }
    ]
    ```

- `GET /patients/search?name={name}` - Search for patient by name

  - **Request Body**: N/A
  - **Reponse Body**:

  ```
  [
      {
          id: string
          name: string
          username: string
          email: string
          mobileNumber: string
          dateOfBirth: string
          gender: Gender
          emergencyContact: {
              name: string
              mobileNumber: string
          }
          familyMembers: string[]
      }
  ]
  ```

- `GET /patients/filter` - Filter patients

  - **Request Body**: N/A
  - **Reponse Body**:

  ```
  [
      {
          id: string
          name: string
          username: string
          email: string
          mobileNumber: string
          dateOfBirth: string
          gender: Gender
          emergencyContact: {
              name: string
              mobileNumber: string
          }
          familyMembers: string[]
      }
  ]
  ```

- `GET /patients/:id` - Get patient by id

  - **Request Body**: N/A
  - **Reponse Body**:

  ```
  {
      id: string
      name: string
      username: string
      email: string
      mobileNumber: string
      dateOfBirth: string
      gender: Gender
      emergencyContact: {
          name: string
          mobileNumber: string
      }
      familyMembers: string[]
  }
  ```

- `GET /patients/username/:username` - Get patient by username
  - **Request Body**: N/A
  - **Reponse Body**:
  ```
  {
      id: string
      name: string
      username: string
      email: string
      mobileNumber: string
      dateOfBirth: string
      gender: Gender
      emergencyContact: {
          name: string
          mobileNumber: string
      }
      familyMembers: string[]
      documents: string[],
      appointments: [
          {
              'id': string,
              'patientID': string,
              'doctorID': string,
              'doctorName': string,
              'doctorTimes': string[],
              'date': string,
              'familyID': string,
              'reservedFor': string
              'status': AppointmentStatus
          }
      ],
      prescriptions: any[],
      notes: string[],
      walletMoney: number
  }
  ```
- `GET /patients/wallet/:id` - Get wallet money for a patient
  - **Request Body**: N/A
  - **Reponse Body**:
  ```
  {
      money: number
  }
  ```
- `GET /patients/viewHealthRecords/me` - Get health notes for current user
  - **Request Body**: N/A
  - **Reponse Body**: `[string]` -> The notes
- `GET /patients/viewMedicalHistory` - Get Medical History for current user

  - **Request Body**: N/A
  - **Reponse Body**: `[string]` -> The url of the documents

- `GET /patients/viewHealthRecords/Files/:id` - Get health notes for user by id
  - **Request Body**: N/A
  - **Reponse Body**: `[string]` -> The notes
- `POST /appointment/createFollowUp` - Create a follow up for a user
  - **Request Body**:
    ```
    {
        doctorID: string,
        patientID: string,
        followUpDate: Date,
        appointmentID: string
    }
    ```
  - **Reponse Body**: N/A
- `POST /patients/deleteMedicalHistory/mine'` - Delete a file from the medical history
  - **Request Body**:
    ```
    {
        url: string, // Url to delete
    }
    ```
  - **Reponse Body**: N/A
- `POST /patients/uploadMedicalHistory/mine` - Upload medical history
  - **Request Body**:
    ```
    {
        medicalHistory: File,
    }
    ```
  - **Reponse Body**: N/A
- `POST `/appointment/requestFollowUp` - Request a follow up
  - **Request Body**:
    ```
    {
      appointmentID: string,
      date: string
    }
    ```
  - **Reponse Body**: N/A
- `POST `/appointment/checkFollowUp/:appointmentID`- Checks if a follow up exists
    - **Request Body**:
        ```
       {
          appointmentID: string,
          date: string
        }
        ```
    - **Reponse Body**:`boolean` -> Whether the follow up exists or not
</details>

<details>
<summary>Prescriptions Endpoints</summary>

- `GET /prescriptions/mine'` - Get all prescriptions of current patient

  - **Request Body**: N/A
  - **Reponse Body**:
    ```
    [
        {
            'id': string,
            'doctor': string,
            'patient': string,
            'date': Date,
            'isFilled': boolean,
            'medicine': [
                {
                    'name': string
                    'dosage': string
                    'quantity': number
                }
            ]
        }
    ]
    ```

- `GET prescriptions/mine/:id` - Get a single prescription by id
  - **Request Body**: N/A
  - **Reponse Body**:
  ```
  {
      id: string
      name: string
      username: string
      email: string
      mobileNumber: string
      dateOfBirth: string
      gender: Gender
      emergencyContact: {
          name: string
          mobileNumber: string
      }
      familyMembers: string[]
  }
  ```
- `GET /prescriptions/:username` - Get prescriptions for patient

  - **Request Body**: N/A
  - **Reponse Body**:
    ```
    [
        {
            'id': string,
            'doctor': string,
            'patient': string,
            'date': Date,
            'isFilled': boolean,
            'medicine': [
                {
                    'name': string
                    'dosage': string
                    'quantity': number
                }
            ]
        }
    ]
    ```

- `POST /prescriptions` - Add a prescription to a patient

  - **Request Body**:
    ```
    {
        patient: string,
        medicine: string,
        date: string,
    }
    ```
    - **Reponse Body**:
      ```
        {
          'id': string,
          'doctor': string,
          'patient': string,
          'date': Date,
          'isFilled': boolean,
          'medicine': [
              {
                  'name': string
                  'dosage': string
                  'quantity': number
              }
          ]
      }
      ```

- `PUT /prescriptions/edit/:id` - Edit a prescription by id
  - **Request Body**:
    ```
    {
      medicine: [
        {
          name: string,
          dosage: string,
          quantity: number,
        }
      ],
      date: Date,
      patient: string // Id of patient
    }
    ```
    - **Reponse Body**: N/A

</details>

## üß™ Tests

We use `jest` to automatically test parts of our code.
To run the tests, run the following command

```bash
> cd backend && npm run test
```

![image](https://github.com/advanced-computer-lab-2023/Copilot-and-Sons-Clinic/blob/main/images/jest.PNG)

We also use `Postman` to manually test all our api references by making sure the response is as expected. We use it as some kind of sanity-check.

Here is an example of testing one of our endpoints using Postman:

![image](https://github.com/advanced-computer-lab-2023/Copilot-and-Sons-Clinic/blob/main/images/postman.PNG)

## üßëüèª‚Äçüè´ How to Use

- Make sure to follow the [Installation](#-installation) steps first

- Add a `.env` in the `backend` of this repo `WanderQuest`

```bash
PORT=4000
MONGO_URI=mongodb+srv://wndrqstaclproj:0kJPyXZCpwhA2vwB@wanderquest.ysdlc.mongodb.net/?retryWrites=true&w=majority&appName=WanderQuest
SECRET=thisisatestsecretcode1234!
EXCHANGE_RATE_API_KEY=878b382f87f70b368b1a1b77
SMTP_HOST=smtp-relay.brevo.com
SMTP_PORT=587
SMTP_USER=81331d001@smtp-brevo.com
SMTP_PASS=xsmtpsib-f4616267d504380fe69fed5abead6b1cca0de777b8b51ca4e11529084c48d7d0-Egz8brFnH0tZ1a9q
SMTP_EMAIL=wanderquest.noreply@gmail.com
STRIPE_SECRET_KEY=rk_test_51QRfekFYbqa6jLuacYBGvdPJNTTSb5JIjiHUaNFnFzC2OpONxNoMy8QlE3tEVFP4fwnKo2hUfaburyCbjjWoDWWN00M07wztsy
```

- Start Front-End

```bash
cd Front-End
cd wanderquest
npm run dev
```

- Start Back-End in a different terminal

```bash
cd Back-End
npm run dev
```

## ü´° Credits

### Docs

- [Mongoose docs](https://mongoosejs.com/docs/)
- [Express docs](https://expressjs.com/en/4x/api.html)
- [ReactJs docs](https://reactjs.org/docs/getting-started.html)
- [NodeJs docs](https://nodejs.org/en/docs/)
- [Docker docs](https://docs.docker.com/)
- [Docker Compose docs](https://docs.docker.com/compose/)
- [Prettier docs](https://prettier.io/docs/en/index.html)
- [MUI docs](https://mui.com/getting-started/usage/)
- [React Router docs](https://reactrouter.com/en/6.21.0)
- [React Hook Form docs](https://react-hook-form.com/get-started)
- [React Query docs](https://react-query.tanstack.com/overview)
- [Formik docs](https://formik.org/docs/overview)
- [Toastify docs](https://fkhadra.github.io/react-toastify/introduction)

### YouTube Videos

- [Mongoose Crash Course](https://www.youtube.com/watch?v=DZBGEVgL2eE)
- [Express Crash Course](https://www.youtube.com/watch?v=SccSCuHhOw0)
- [ReactJs Crash Course](https://www.youtube.com/watch?v=w7ejDZ8SWv8)
- [MUI Crash Course](https://www.youtube.com/watch?v=vyJU9efvUtQ)
- [React Router Crash Course](https://www.youtube.com/watch?v=Law7wfdg_ls)
- [React Hook Form Crash Course](https://www.youtube.com/watch?v=-mFXqOaqgZk)
- [React Query Crash Course](https://www.youtube.com/watch?v=seU46c6Jz7E)

## üìú License

The software is open source under the `Apache 2.0 License`.

[Apache 2.0](https://www.apache.org/licenses/LICENSE-2.0)
